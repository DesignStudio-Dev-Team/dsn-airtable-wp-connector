name: Release Plugin

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Build and Zip
      run: |
        # Create deployment directory
        mkdir dsn-airtable-wp-connector
        
        # Copy files to directory
        # Using rsync to exclude unwanted files
        rsync -av --progress ./ dsn-airtable-wp-connector/ --exclude dsn-airtable-wp-connector --exclude .git --exclude .github --exclude .gitignore --exclude .DS_Store
        
        # Zip the directory
        zip -r dsn-airtable-wp-connector.zip dsn-airtable-wp-connector

    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        files: dsn-airtable-wp-connector.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
